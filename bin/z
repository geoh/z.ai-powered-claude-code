#!/bin/bash

# Read the configuration file
CONFIG_FILE="$HOME/.zai.json"

# Check if the config file exists
if [ ! -f "$CONFIG_FILE" ]; then
    echo "Error: Configuration file $CONFIG_FILE not found."
    exit 1
fi

# Extract values using jq
API_KEY=$(jq -r '.apiKey' "$CONFIG_FILE")
OPUS_MODEL=$(jq -r '.opusModel' "$CONFIG_FILE")
SONNET_MODEL=$(jq -r '.sonnetModel' "$CONFIG_FILE")
HAIKU_MODEL=$(jq -r '.haikuModel' "$CONFIG_FILE")
SUBAGENT_MODEL=$(jq -r '.subagentModel' "$CONFIG_FILE")
ENABLE_THINKING=$(jq -r '.enableThinking' "$CONFIG_FILE")
ENABLE_STREAMING=$(jq -r '.enableStreaming' "$CONFIG_FILE")
REASONING_EFFORT=$(jq -r '.reasoningEffort' "$CONFIG_FILE")  # Values: "auto", "low", "medium", or "high"
MAX_THINKING_TOKENS=$(jq -r '.maxThinkingTokens' "$CONFIG_FILE")
MAX_OUTPUT_TOKENS=$(jq -r '.maxOutputTokens' "$CONFIG_FILE")

# Set environment variables for Z.AI
export ANTHROPIC_BASE_URL="https://api.z.ai/api/anthropic"
export ANTHROPIC_AUTH_TOKEN="$API_KEY"
export ANTHROPIC_DEFAULT_OPUS_MODEL="$OPUS_MODEL"
export ANTHROPIC_DEFAULT_SONNET_MODEL="$SONNET_MODEL"
export ANTHROPIC_DEFAULT_HAIKU_MODEL="$HAIKU_MODEL"
export CLAUDE_CODE_SUBAGENT_MODEL="$SUBAGENT_MODEL"
export ENABLE_THINKING="$ENABLE_THINKING"
export ENABLE_STREAMING="$ENABLE_STREAMING"
export REASONING_EFFORT="$REASONING_EFFORT"
export MAX_THINKING_TOKENS="$MAX_THINKING_TOKENS"
export MAX_OUTPUT_TOKENS="$MAX_OUTPUT_TOKENS"

# Privacy configuration
export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1

# Launch Claude Code
claude "$@"